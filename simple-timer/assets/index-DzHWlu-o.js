(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class d{static secondsToFormattedTime(t){const e=Math.floor(t/3600),s=Math.floor(t%3600/60),i=t%60,r=o=>o.toString().padStart(2,"0");return`${r(e)}:${r(s)}:${r(i)}`}static secondsToTime(t){const e=Math.floor(t/3600),s=t%3600,i=Math.floor(s/60),r=s%60;return{hours:e,minutes:i,seconds:r}}static formatTime(t,e=!1,s){const i=new Date(0),r=e?20+s:19;return i.setMilliseconds(t*1e3),i.toISOString().substring(11,r)}}class h{tickMs;second=1e3;storageAvailable=!1;options;timerNode;timerInterval;timerSeconds;timerState;initialized=!1;directionFlag=!0;config={fewAttr:"data-few",storagePrefix:"_awenn2015_simple_timer_"};listeners={stop:[],play:[],pause:[],reset:[]};defaultOptions={seconds:900,few:null,fewColor:"red",setFewColor:!1,redirect:!1,redirectUrl:null,saveInStorage:!1,displayMilliseconds:!1,fractionDigits:1,autoPlay:!0,storageId:null,bounce:!1};optionTypes={seconds:{type:"number",nullable:!1},few:{type:"number",nullable:!0},fewColor:{type:"string",nullable:!0},setFewColor:{type:"boolean",nullable:!1},redirect:{type:"boolean",nullable:!1},redirectUrl:{type:"string",nullable:!0},saveInStorage:{type:"boolean",nullable:!1},displayMilliseconds:{type:"boolean",nullable:!1},fractionDigits:{type:"number",nullable:!1},autoPlay:{type:"boolean",nullable:!1},storageId:{type:"string",nullable:!0},bounce:{type:"boolean",nullable:!1}};constructor(t,e){if(!t)throw new Error("Invalid selector");const s=document.querySelector(t);if(!s)throw new Error("Invalid timer node");this.timerSeconds=0,this.timerInterval=0,this.timerNode=s,this.timerState="stop",this.storageAvailable=this.getStorageAvailable();const i={...this.defaultOptions,...e};i.fractionDigits>2&&(i.fractionDigits=2),i.fractionDigits<0&&(i.fractionDigits=1),i.fractionDigits<1&&(i.displayMilliseconds=!1),this.options=this.validateOptions(i),this.tickMs=this.options.displayMilliseconds?this.second/10**this.options.fractionDigits:this.second,this.drawPlaceholder()}getState(){return this.timerState}getOptionKeys(){return Object.keys(this.defaultOptions)}getOptionTypes(){return this.optionTypes}initialize(){if(this.initialized)throw new Error("Invalid initialization");this.timerSeconds=this.options.seconds,this.writeTimerSecondsFromStorage(),this.options.autoPlay?(this.playTimer(),this.notifyListeners("play")):(this.drawTimer(),this.setStateAndNotifyListeners("pause")),this.initialized=!0}pause(){if(console.log(this.timerState),["pause","stop"].includes(this.timerState)){window.alert("Таймер уже был остановлен.");return}clearTimeout(this.timerInterval),this.setStateAndNotifyListeners("pause")}play(){if(this.timerState!=="pause"){this.timerState!=="play"&&window.alert("Невозможно восстановить таймер.");return}clearTimeout(this.timerInterval),this.playTimer(),this.notifyListeners("play")}stop(){if(this.timerState==="stop"){window.alert("Таймер уже был остановлен.");return}clearTimeout(this.timerInterval),this.timerSeconds=0,this.drawTimer(),this.setStateAndNotifyListeners("stop")}reset(){const{seconds:t,autoPlay:e}=this.options;clearTimeout(this.timerInterval),this.timerSeconds=t,e?(this.playTimer(),this.notifyListeners("reset")):(this.drawTimer(),this.setStateAndNotifyListeners("pause"))}addEventListener(t,e){this.listeners[t].push(e)}notifyListeners(t){for(const e of this.listeners[t])e()}setStateAndNotifyListeners(t){this.timerState=t,this.notifyListeners(t)}playTimer(){this.drawTimer(),this.timerSeconds&&(this.timerState="play",this.timerInterval=setInterval(this.intervalTick.bind(this),this.tickMs))}intervalTick(){this.directionFlag?this.timerSeconds-=this.tickMs/this.second:this.timerSeconds+=this.tickMs/this.second,this.timerSeconds=+this.timerSeconds.toFixed(this.options.fractionDigits),this.drawTimer(),!this.options.bounce&&this.timerSeconds<=0&&(clearInterval(this.timerInterval),this.setStateAndNotifyListeners("stop"),this.options.redirect&&this.options.redirectUrl&&setTimeout(()=>{window.location.href=this.options.redirectUrl},this.second));const t=this.timerSeconds===0,e=this.timerSeconds>=this.options.seconds;(this.options.bounce&&t||e)&&(this.directionFlag=!this.directionFlag)}formatTime(t){return d.formatTime(t,this.options.displayMilliseconds,this.options.fractionDigits)}drawTimer(){const{few:t,fewColor:e,setFewColor:s,saveInStorage:i}=this.options;if(this.timerNode.innerText=this.formatTime(this.timerSeconds),t!==null){const r=this.timerSeconds<=t,o=this.timerNode.hasAttribute(this.config.fewAttr);r?o||(this.timerNode.setAttribute(this.config.fewAttr,""),s&&this.timerNode.style.setProperty("color",e)):(this.timerNode.removeAttribute(this.config.fewAttr),s&&this.timerNode.style.removeProperty("color"))}if(this.storageAvailable&&i&&this.timerSeconds>=0){const r=this.getStorageKey();localStorage.setItem(r,String(this.timerSeconds))}}validateOptions(t){const e={seconds:{nullable:!1,validator:[typeof t.seconds!="number",t.seconds<=0]},few:{nullable:!0,validator:[t.few!==null&&typeof t.few!="number",typeof t.few=="number"&&t.few<0,typeof t.few=="number"&&t.few>=t.seconds]},fewColor:{nullable:!0,validator:[t.fewColor!==null&&typeof t.fewColor!="string",typeof t.fewColor=="string"&&t.fewColor.length===0]},redirectUrl:{nullable:!0,validator:[t.redirectUrl!==null&&typeof t.redirectUrl!="string",typeof t.redirectUrl=="string"&&t.redirectUrl?.length===0]}};for(const s in e)if(e[s].validator.some(Boolean))throw new TypeError(`Invalid argument for the "${s}" option was passed`);return t}drawPlaceholder(){const{displayMilliseconds:t,fractionDigits:e}=this.options,s=t?"."+"0".repeat(e):"";this.timerNode.innerText="00:00:00"+s}getStorageKey(){const t=this.getStorageIdAndClearOthers()||this.findPrevStorageIdAndClearOthers()||this.generateStorageId();return this.config.storagePrefix+t}getStorageAvailable(){try{const t="__test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}loopStorage(t){if(!this.storageAvailable)return null;for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);if(!s)break;const i=t(s);if(typeof i=="boolean"&&i)return s}return null}clearStorageIds(t){this.storageAvailable&&this.loopStorage(e=>{if(e.startsWith(this.config.storagePrefix)){if(t&&e.endsWith(t))return;localStorage.removeItem(e)}})}findPrevStorageKey(){return this.storageAvailable?this.loopStorage(t=>t.startsWith(this.config.storagePrefix)):null}findPrevStorageId(){if(!this.storageAvailable)return null;const t=this.findPrevStorageKey();return t&&t.replace(this.config.storagePrefix,"")}findPrevStorageIdAndClearOthers(){if(!this.storageAvailable)return null;const t=this.findPrevStorageId();return t?(this.clearStorageIds(t),t):null}getStorageIdAndClearOthers(){return this.options.storageId&&this.clearStorageIds(this.options.storageId),this.options.storageId}generateStorageId(t=15){const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let s="";for(let i=0;i<t;i++){const r=Math.floor(Math.random()*e.length);s+=e[r]}return s}writeTimerSecondsFromStorage(){if(this.storageAvailable)if(!this.options.saveInStorage)this.clearStorageIds(null);else{const t=this.options.storageId||this.findPrevStorageId();if(!t)return;const e=this.config.storagePrefix+t,s=localStorage.getItem(e);s&&+s>=0&&(this.timerSeconds=+s)}}}class l{timer=null;controls={play:null,stop:null,pause:null,reset:null};handlers={play:null,stop:null,pause:null,reset:null};defaultOptions={few:30,seconds:90,fewColor:"red",setFewColor:!0,saveInStorage:!0,displayMilliseconds:!0,fractionDigits:2,autoPlay:!1};constructor(){const t=document.querySelector("#setting-form"),e=document.querySelector("#timer-controls");if(!e)throw new Error("Timer controls wrapper not found.");this.controls.play=e?.querySelector('input[type="button"][data-play]'),this.controls.stop=e?.querySelector('input[type="button"][data-stop]'),this.controls.pause=e?.querySelector('input[type="button"][data-pause]'),this.controls.reset=e?.querySelector('input[type="button"][data-reset]'),this.initialize(this.defaultOptions),t?.addEventListener("submit",this.onSettingFormSubmit.bind(this))}static factory(){return new l}initialize(t){const e={...this.defaultOptions,...t};this.timer=new h("#timer",e),this.handlers.play=this.timer.play.bind(this.timer),this.handlers.stop=this.timer.stop.bind(this.timer),this.handlers.pause=this.timer.pause.bind(this.timer),this.handlers.reset=this.timer.reset.bind(this.timer),this.controls.play?.addEventListener("click",this.handlers.play),this.controls.stop?.addEventListener("click",this.handlers.stop),this.controls.pause?.addEventListener("click",this.handlers.pause),this.controls.reset?.addEventListener("click",this.handlers.reset),this.timer.initialize()}destroy(){this.timer&&(this.controls.play?.removeEventListener("click",this.handlers.play),this.controls.stop?.removeEventListener("click",this.handlers.stop),this.controls.pause?.removeEventListener("click",this.handlers.pause),this.controls.reset?.removeEventListener("click",this.handlers.reset),this.timer.stop()),this.timer=null}onSettingFormSubmit(t){t.preventDefault();const e=new FormData(t.target),s=this.parseOptions(e);this.destroy(),this.initialize(s)}typeConversion(t,e){switch(e){case"string":return t!==null?String(t):null;case"number":return t!==null?+t:null;case"boolean":return!!t;case"object":return null}}parseOptions(t){if(!this.timer)throw new Error("Invalid timer");return Object.entries(this.timer.getOptionTypes()).reduce((e,[s,i])=>{const r=t.get(s),o=r&&String(r),n=this.typeConversion(o,i.type),c=["string","number"].includes(typeof n);return i.nullable&&c&&!n?(e[s]=null,e):(e[s]=n,e)},{})}}document.addEventListener("DOMContentLoaded",()=>{l.factory()});
